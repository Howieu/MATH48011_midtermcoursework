# R è„šæœ¬è¿è¡ŒæŒ‡å—

## ğŸ¯ ä¸‰æ­¥å¿«é€Ÿå¼€å§‹

### ç¬¬ä¸€æ­¥ï¼šå®‰è£… R åŒ…

åœ¨ R æ§åˆ¶å°æˆ–ç»ˆç«¯ä¸­è¿è¡Œï¼ˆåªéœ€è¦è¿è¡Œä¸€æ¬¡ï¼‰ï¼š

```r
install.packages("tidyverse")
install.packages("broom")
```

### ç¬¬äºŒæ­¥ï¼šæµ‹è¯•ç¯å¢ƒ

å…ˆè¿è¡Œæµ‹è¯•è„šæœ¬ç¡®ä¿ä¸€åˆ‡æ­£å¸¸ï¼š

```r
# è®¾ç½®å·¥ä½œç›®å½•ï¼ˆæ ¹æ®ä½ çš„å®é™…è·¯å¾„ä¿®æ”¹ï¼‰
setwd("/path/to/MATH48011_midtermcoursework")

# è¿è¡Œæµ‹è¯•è„šæœ¬
source("test_setup.R")
```

å¦‚æœçœ‹åˆ°æ‰€æœ‰ âœ“ ç¬¦å·ï¼Œè¯´æ˜ç¯å¢ƒé…ç½®æ­£ç¡®ï¼

### ç¬¬ä¸‰æ­¥ï¼šè¿è¡Œä¸»åˆ†æ

```r
source("semaglutide_analysis.R")
```

---

## ğŸ“– è¯¦ç»†æ­¥éª¤

### A. åœ¨ RStudio ä¸­è¿è¡Œï¼ˆæ¨èæ–°æ‰‹ï¼‰

#### 1. æ‰“å¼€é¡¹ç›®

- æ–¹æ³• 1ï¼šåŒå‡» `.Rproj` æ–‡ä»¶ï¼ˆå¦‚æœæœ‰ï¼‰
- æ–¹æ³• 2ï¼šFile â†’ Open Project â†’ é€‰æ‹©é¡¹ç›®æ–‡ä»¶å¤¹

#### 2. æ‰“å¼€è„šæœ¬

- File â†’ Open File â†’ é€‰æ‹© `semaglutide_analysis.R`

#### 3. è®¾ç½®å·¥ä½œç›®å½•

åœ¨ RStudio èœå•ä¸­ï¼š
```
Session â†’ Set Working Directory â†’ To Source File Location
```

æˆ–è€…åœ¨æ§åˆ¶å°è¿è¡Œï¼š
```r
setwd("~/MATH48011_midtermcoursework")  # æ ¹æ®å®é™…è·¯å¾„ä¿®æ”¹
```

#### 4. å®‰è£…åŒ…ï¼ˆé¦–æ¬¡è¿è¡Œï¼‰

åœ¨æ§åˆ¶å°è¿è¡Œï¼š
```r
install.packages("tidyverse")
install.packages("broom")
```

#### 5. è¿è¡Œè„šæœ¬

**æ–¹æ³• Aï¼šè¿è¡Œæ•´ä¸ªè„šæœ¬**
- ç‚¹å‡»å³ä¸Šè§’çš„ **Source** æŒ‰é’®
- å¿«æ·é”®ï¼š**Ctrl+Shift+S** (Windows/Linux) æˆ– **Cmd+Shift+S** (Mac)

**æ–¹æ³• Bï¼šé€è¡Œè¿è¡Œï¼ˆæ¨èå­¦ä¹ ï¼‰**
- å…‰æ ‡æ”¾åœ¨æŸè¡Œï¼ŒæŒ‰ **Ctrl+Enter** (Windows/Linux) æˆ– **Cmd+Enter** (Mac)
- é€‰ä¸­å¤šè¡Œä»£ç ï¼ŒæŒ‰ **Ctrl+Enter** è¿è¡Œé€‰ä¸­éƒ¨åˆ†

**æ–¹æ³• Cï¼šè¿è¡Œåˆ°å½“å‰è¡Œ**
- å¿«æ·é”®ï¼š**Ctrl+Alt+B** (Windows/Linux) æˆ– **Cmd+Option+B** (Mac)

#### 6. æŸ¥çœ‹ç»“æœ

- **æ§åˆ¶å°è¾“å‡º**ï¼šConsole çª—å£ï¼ˆå·¦ä¸‹æˆ–å·¦è¾¹ï¼‰
- **å›¾è¡¨**ï¼šPlots çª—å£ï¼ˆå³ä¸‹ï¼‰ï¼Œå¯ä»¥ç‚¹å‡»ç®­å¤´åˆ‡æ¢å›¾è¡¨
- **å˜é‡**ï¼šEnvironment çª—å£ï¼ˆå³ä¸Šï¼‰ï¼Œå¯ä»¥æŸ¥çœ‹æ‰€æœ‰æ•°æ®å’Œæ¨¡å‹
- **å¸®åŠ©**ï¼šHelp çª—å£ï¼ˆå³ä¸‹ï¼‰ï¼Œå¯ä»¥æŸ¥çœ‹å‡½æ•°æ–‡æ¡£

#### 7. ä¿å­˜å›¾è¡¨

åœ¨ Plots çª—å£ï¼š
- ç‚¹å‡» **Export** â†’ **Save as Image** æˆ– **Save as PDF**
- å›¾è¡¨å·²è‡ªåŠ¨ä¿å­˜ä¸º PNG æ–‡ä»¶åœ¨å·¥ä½œç›®å½•ä¸­

---

### B. åœ¨ VSCode ä¸­è¿è¡Œï¼ˆæ¨èè¿›é˜¶ç”¨æˆ·ï¼‰

#### 1. å®‰è£…æ‰©å±•

åœ¨ VSCode æ‰©å±•å•†åº—æœç´¢å¹¶å®‰è£…ï¼š
- **R** (by REditorSupport) - å¿…éœ€
- **R Debugger** (by REditorSupport) - å¯é€‰

#### 2. é…ç½® R è·¯å¾„

æŒ‰ **Ctrl+,** æ‰“å¼€è®¾ç½®ï¼Œæœç´¢ "r.rpath"ï¼Œè®¾ç½® R çš„è·¯å¾„ï¼š

**Windows:**
```
C:\Program Files\R\R-4.3.2\bin\R.exe
```

**Mac:**
```
/usr/local/bin/R
```

**Linux:**
```
/usr/bin/R
```

#### 3. å®‰è£… R åŒ…

æ‰“å¼€ VSCode ç»ˆç«¯ï¼ˆ**Ctrl+`**ï¼‰ï¼Œè¿è¡Œï¼š

```bash
R
```

è¿›å…¥ R æ§åˆ¶å°åï¼š

```r
install.packages("tidyverse")
install.packages("broom")
install.packages("languageserver")  # VSCode éœ€è¦
```

æŒ‰ **Ctrl+D** æˆ–è¾“å…¥ `quit()` é€€å‡º R

#### 4. æ‰“å¼€é¡¹ç›®

- File â†’ Open Folder â†’ é€‰æ‹© `MATH48011_midtermcoursework` æ–‡ä»¶å¤¹
- åœ¨å·¦ä¾§æ–‡ä»¶æ ‘ä¸­æ‰“å¼€ `semaglutide_analysis.R`

#### 5. å¯åŠ¨ R ç»ˆç«¯

- æŒ‰ **Ctrl+`** æ‰“å¼€ç»ˆç«¯
- ç‚¹å‡»ç»ˆç«¯å³ä¸Šè§’çš„ **+** æ—è¾¹çš„ä¸‹æ‹‰ç®­å¤´
- é€‰æ‹© **R Terminal**

#### 6. è¿è¡Œè„šæœ¬

**æ–¹æ³• Aï¼šè¿è¡Œæ•´ä¸ªè„šæœ¬**

åœ¨ R ç»ˆç«¯ä¸­è¾“å…¥ï¼š
```r
source("semaglutide_analysis.R")
```

**æ–¹æ³• Bï¼šé€è¡Œè¿è¡Œï¼ˆæ¨èï¼‰**

1. é€‰ä¸­è¦è¿è¡Œçš„ä»£ç è¡Œï¼ˆå¯ä»¥å¤šè¡Œï¼‰
2. æŒ‰ **Ctrl+Enter** å‘é€åˆ° R ç»ˆç«¯
3. æˆ–è€…å³é”® â†’ "Run Selection/Line in Active Terminal"

**æ–¹æ³• Cï¼šä½¿ç”¨å‘½ä»¤é¢æ¿**

1. æŒ‰ **Ctrl+Shift+P**
2. è¾“å…¥ "R: Run Source" è¿è¡Œæ•´ä¸ªè„šæœ¬
3. æˆ–è¾“å…¥ "R: Run Selection/Line" è¿è¡Œå½“å‰è¡Œ

#### 7. æŸ¥çœ‹ç»“æœ

- **æ–‡å­—è¾“å‡º**ï¼šåœ¨ R ç»ˆç«¯ä¸­æ˜¾ç¤º
- **å›¾è¡¨**ï¼š
  - ä¼šåœ¨æ–°çª—å£å¼¹å‡ºï¼ˆå¦‚æœé…ç½®äº† X11/XQuartzï¼‰
  - æˆ–è€…ç›´æ¥æŸ¥çœ‹ä¿å­˜çš„ PNG æ–‡ä»¶
  - å¯ä»¥å®‰è£… **R Plot Viewer** æ‰©å±•æ¥åœ¨ VSCode å†…æŸ¥çœ‹

---

## ğŸ”§ å¸¸è§é—®é¢˜è§£å†³

### é—®é¢˜ 1: "æ‰¾ä¸åˆ°åŒ… 'tidyverse'"

**è§£å†³æ–¹æ³•ï¼š**
```r
install.packages("tidyverse")
```

å¦‚æœå®‰è£…å¤±è´¥ï¼Œå°è¯•ï¼š
```r
# é€‰æ‹©å›½å†…é•œåƒ
options(repos = c(CRAN = "https://mirrors.tuna.tsinghua.edu.cn/CRAN/"))
install.packages("tidyverse")
```

### é—®é¢˜ 2: "æ‰¾ä¸åˆ° Semaglutide.csv"

**è§£å†³æ–¹æ³•ï¼š**

æ£€æŸ¥å·¥ä½œç›®å½•ï¼š
```r
getwd()  # æŸ¥çœ‹å½“å‰å·¥ä½œç›®å½•
```

è®¾ç½®æ­£ç¡®çš„å·¥ä½œç›®å½•ï¼š
```r
setwd("/path/to/MATH48011_midtermcoursework")
```

æˆ–è€…åœ¨ RStudio ä¸­ï¼š
```
Session â†’ Set Working Directory â†’ Choose Directory
```

### é—®é¢˜ 3: "å›¾è¡¨ä¸æ˜¾ç¤º"

**RStudio:**
- æ£€æŸ¥ Plots çª—å£æ˜¯å¦æœ€å°åŒ–
- ç‚¹å‡» Plots çª—å£çš„æ”¾å¤§æŒ‰é’®

**VSCode:**
- å›¾è¡¨ä¼šè‡ªåŠ¨ä¿å­˜ä¸º PNG æ–‡ä»¶
- åœ¨æ–‡ä»¶æµè§ˆå™¨ä¸­ç›´æ¥æ‰“å¼€ PNG æ–‡ä»¶æŸ¥çœ‹
- æˆ–è€…å®‰è£…å›¾å½¢åç«¯ï¼š
  ```r
  # Mac
  install.packages("Cairo")

  # Windows
  # é€šå¸¸ä¸éœ€è¦é¢å¤–é…ç½®

  # Linux
  sudo apt-get install libcairo2-dev  # Ubuntu/Debian
  ```

### é—®é¢˜ 4: "ä¸­æ–‡æ˜¾ç¤ºä¹±ç "

**è§£å†³æ–¹æ³•ï¼š**
```r
# åœ¨è„šæœ¬å¼€å¤´æ·»åŠ 
Sys.setlocale("LC_ALL", "zh_CN.UTF-8")  # Linux/Mac
Sys.setlocale("LC_ALL", "Chinese")      # Windows
```

### é—®é¢˜ 5: "å†…å­˜ä¸è¶³"

**è§£å†³æ–¹æ³•ï¼š**
```r
# å¢åŠ å†…å­˜é™åˆ¶ï¼ˆä»… Windowsï¼‰
memory.limit(size = 8000)  # è®¾ç½®ä¸º 8GB

# æˆ–è€…æ¸…ç†å·¥ä½œç©ºé—´
rm(list = ls())  # åˆ é™¤æ‰€æœ‰å˜é‡
gc()             # åƒåœ¾å›æ”¶
```

---

## ğŸ’¡ å®ç”¨æŠ€å·§

### 1. åªè¿è¡Œç‰¹å®šéƒ¨åˆ†

å¦‚æœä½ åªæƒ³è¿è¡Œç‰¹å®šé—®é¢˜çš„ä»£ç ï¼š

```r
# åŠ è½½åŒ…å’Œæ•°æ®
library(tidyverse)
library(broom)
data <- read_csv("Semaglutide.csv")
data <- data %>% mutate(sex = as.factor(sex))
data_with_dummy <- data %>% mutate(w = ifelse(sex == "F", 1, 0))

# ç„¶åè¿è¡Œä½ æ„Ÿå…´è¶£çš„éƒ¨åˆ†
# ä¾‹å¦‚åªè¿è¡Œé—®é¢˜ 2ï¼ˆæ‹Ÿåˆæ¨¡å‹ Fï¼‰
fit_F <- lm(MWDR ~ age + I(age^2) + w + age:w, data = data_with_dummy)
summary(fit_F)
```

### 2. äº¤äº’å¼æ¢ç´¢æ•°æ®

```r
# æŸ¥çœ‹æ•°æ®ç»“æ„
str(data)
glimpse(data)  # tidyverse ç‰ˆæœ¬

# æŸ¥çœ‹å‰å‡ è¡Œ
head(data, 10)

# ç»Ÿè®¡æ‘˜è¦
summary(data)

# æŸ¥çœ‹æ¨¡å‹ç»“æœ
summary(fit_F)
coef(fit_F)
confint(fit_F)
```

### 3. è‡ªå®šä¹‰å›¾è¡¨

```r
# ä¿®æ”¹å›¾è¡¨ä¸»é¢˜
plot1 + theme_bw()           # é»‘ç™½ä¸»é¢˜
plot1 + theme_minimal()      # ç®€çº¦ä¸»é¢˜
plot1 + theme_classic()      # ç»å…¸ä¸»é¢˜

# è°ƒæ•´å›¾è¡¨å¤§å°
ggsave("my_plot.png", plot1, width = 10, height = 8, dpi = 300)

# ä¿å­˜ä¸º PDFï¼ˆçŸ¢é‡å›¾ï¼Œç”¨äºè®ºæ–‡ï¼‰
ggsave("my_plot.pdf", plot1, width = 10, height = 8)
```

### 4. ä¿å­˜å·¥ä½œç©ºé—´

```r
# ä¿å­˜æ‰€æœ‰å˜é‡
save.image("analysis_workspace.RData")

# ä¸‹æ¬¡ç»§ç»­å·¥ä½œ
load("analysis_workspace.RData")

# åªä¿å­˜ç‰¹å®šå¯¹è±¡
save(fit_F, data_with_dummy, file = "model_results.RData")
```

### 5. å¯¼å‡ºç»“æœåˆ°æ–‡ä»¶

```r
# å¯¼å‡ºæ¨¡å‹ç³»æ•°è¡¨
library(broom)
tidy_fit <- tidy(fit_F)
write_csv(tidy_fit, "model_coefficients.csv")

# å¯¼å‡ºé¢„æµ‹ç»“æœ
predictions <- augment(fit_F)
write_csv(predictions, "predictions.csv")
```

---

## ğŸ“Š æŸ¥çœ‹æ‰€æœ‰ç”Ÿæˆçš„å›¾è¡¨

è¿è¡Œå®Œæˆåï¼Œä½¿ç”¨æ–‡ä»¶ç®¡ç†å™¨æˆ–åœ¨ R ä¸­ï¼š

```r
# åˆ—å‡ºæ‰€æœ‰ PNG æ–‡ä»¶
list.files(pattern = "\\.png$")

# åœ¨ RStudio ä¸­æŸ¥çœ‹å›¾ç‰‡
# Files çª—å£ â†’ ç‚¹å‡» PNG æ–‡ä»¶

# åœ¨ç³»ç»Ÿé»˜è®¤ç¨‹åºä¸­æ‰“å¼€
system("open plot1_MWDR_vs_age.png")        # Mac
system("xdg-open plot1_MWDR_vs_age.png")    # Linux
shell.exec("plot1_MWDR_vs_age.png")         # Windows
```

---

## âš¡ æ€§èƒ½ä¼˜åŒ–

å¦‚æœè„šæœ¬è¿è¡Œè¾ƒæ…¢ï¼š

```r
# 1. åªè¿è¡Œå¿…è¦çš„éƒ¨åˆ†ï¼ˆæ³¨é‡Šæ‰ä¸éœ€è¦çš„å›¾è¡¨ï¼‰

# 2. å‡å°‘å›¾è¡¨ç‚¹æ•°
prediction_grid <- expand.grid(
  age = seq(min(data_with_dummy$age), max(data_with_dummy$age),
            length.out = 50),  # ä» 100 å‡å°‘åˆ° 50
  w = c(0, 1)
)

# 3. é™ä½å›¾è¡¨åˆ†è¾¨ç‡ï¼ˆå¦‚æœåªæ˜¯é¢„è§ˆï¼‰
ggsave("plot1.png", plot1, width = 8, height = 6, dpi = 150)  # é™ä½ DPI
```

---

## ğŸ“ åˆ†æ­¥å­¦ä¹ å»ºè®®

å¦‚æœä½ æ˜¯ R æ–°æ‰‹ï¼Œå»ºè®®æŒ‰ä»¥ä¸‹é¡ºåºå­¦ä¹ ï¼š

1. **ç¬¬ä¸€å¤©**ï¼š
   - è¿è¡Œ `test_setup.R` ç¡®ä¿ç¯å¢ƒæ­£ç¡®
   - è¿è¡Œé—®é¢˜ 1ï¼ˆæ¢ç´¢æ€§å›¾è¡¨ï¼‰
   - ç†è§£ ggplot2 çš„åŸºæœ¬è¯­æ³•

2. **ç¬¬äºŒå¤©**ï¼š
   - è¿è¡Œé—®é¢˜ 2ï¼ˆæ‹Ÿåˆæ¨¡å‹ï¼‰
   - ç†è§£ `lm()` å‡½æ•°å’Œæ¨¡å‹å…¬å¼è¯­æ³•
   - å­¦ä¹  `broom::tidy()` å’Œ `summary()`

3. **ç¬¬ä¸‰å¤©**ï¼š
   - è¿è¡Œé—®é¢˜ 4ï¼ˆæ¨¡å‹è¯Šæ–­ï¼‰
   - ç†è§£æ®‹å·®å›¾çš„å«ä¹‰
   - å­¦ä¹ å¦‚ä½•åˆ¤æ–­æ¨¡å‹å‡è®¾æ˜¯å¦æ»¡è¶³

4. **ç¬¬å››å¤©**ï¼š
   - è¿è¡Œé—®é¢˜ 5 å’Œ 6ï¼ˆæ¨æ–­å’Œé¢„æµ‹ï¼‰
   - ç†è§£å‡è®¾æ£€éªŒçš„è¿‡ç¨‹
   - åŒºåˆ†ç½®ä¿¡åŒºé—´å’Œé¢„æµ‹åŒºé—´

---

## ğŸ†˜ è·å–å¸®åŠ©

### æŸ¥çœ‹å‡½æ•°å¸®åŠ©

```r
?lm              # æŸ¥çœ‹ lm å‡½æ•°æ–‡æ¡£
?ggplot          # æŸ¥çœ‹ ggplot å‡½æ•°æ–‡æ¡£
help(predict)    # å¦ä¸€ç§æ–¹å¼

# æŸ¥çœ‹ç¤ºä¾‹
example(lm)
```

### åœ¨çº¿èµ„æº

- **tidyverse å®˜æ–¹æ–‡æ¡£**: https://www.tidyverse.org/
- **ggplot2 æ–‡æ¡£**: https://ggplot2.tidyverse.org/
- **R for Data Science (å…è´¹ä¹¦ç±)**: https://r4ds.had.co.nz/

---

ç¥ä½ åˆ†æé¡ºåˆ©ï¼å¦‚æœæœ‰ä»»ä½•é—®é¢˜ï¼Œéšæ—¶æŸ¥çœ‹è¿™ä¸ªæŒ‡å—ã€‚
